<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Another GameBoy Emulator written in Rust</title>
    <link rel="stylesheet" href="content/style.css" />
</head>

<body>
    <div class="gameboy-container">
        <div id="gameboy-case" class="gameboy-case">
            <div class="gameboy-screen-border">
                <div class="gameboy-screen-bg"></div>
                <div class="gameboy-screen-container">
                    <canvas id="gameboy-screen" width="160" height="144">
                    </canvas>
                </div>
                <div class="menu-overlay-container">
                    <div class="menu-overlay-background">
                    </div>
                    <div class="menu-bar-bottom-background">
                    </div>
                    <div class="menu-bar-bottom-container">
                        <div class="gameboy-controls-left">
                            <!--
                            <input id="button-pause" type="button" value="&#x23f5;">
                            -->
                            <button id="button-pause">&#xFE0E;&#x23f8;</button>
                        </div>
                        <div class="gameboy-controls-right">
                            <span>&#x1f50a;</span>
                            <input id="volume-control" type="range" style="width: 128px;">
                        </div>
                    </div>
                </div>
                <div id="power-led" class="power-led-off">
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import {
            registerCanvas,
            registerFileDropOn,
            initialize,
            isEmulatorPaused,
            setEmulatorPaused,
            getVolume,
            setVolume,
        } from "./content/script.js";

        let gb          = document.getElementById("gameboy-case");
        let canvas      = document.getElementById("gameboy-screen");
        let bt_pause    = document.getElementById("button-pause");
        let volume_ctrl = document.getElementById("volume-control");

        registerFileDropOn(gb);
        registerCanvas(canvas);
        initialize();

        // handle click to pause/unpause
        bt_pause.addEventListener("click", function(ev) {
            if (isEmulatorPaused()) {
                setEmulatorPaused(false);
                bt_pause.innerHTML = "&#xFE0E;&#x23f8;";
            }
            else {
                setEmulatorPaused(true);
                bt_pause.innerHTML = "&#xFE0E;&#x23f5;";
            }

            ev.stopPropagation();
        });

        // handle volume change
        volume_ctrl.value = getVolume();
        volume_ctrl.addEventListener("click", function(ev) {
            ev.stopPropagation();
        })
        volume_ctrl.addEventListener("input", function(ev) {
            let v = volume_ctrl.value;
            setVolume(v);

            ev.stopPropagation();
            ev.preventDefault();
        });
    </script>
</body>
</html>